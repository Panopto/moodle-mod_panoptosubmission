define(["jquery","core/notification","core/modal_factory","core/str"],(l,r,e,h)=>{let m=null;var i=(t,i,a)=>{Promise.all([h.get_string("select_submission","panoptosubmission"),e.create({type:e.types.DEFAULT,body:`<iframe class="mod-panoptosubmission-iframe-custom" src="${t}" frameborder="0"></iframe>`})]).then(([t,i])=>{i.setTitle(t),i.getRoot().addClass("mod-panoptosubmission-modal-custom-size");var t=window.innerWidth,a=i.getRoot().find(".modal-dialog"),e=i.getRoot().find(".modal-content"),d=i.getRoot().find(".modal-body");a.addClass("mod-panoptosubmission-modal-dialog-custom"),e.addClass("mod-panoptosubmission-modal-content-custom"),d.addClass("mod-panoptosubmission-modal-body-custom"),t<=600?(a.css({width:"98vw","max-width":"98vw",margin:"0.25rem auto"}),e.css({height:"50vh","max-height":"50vh"}),d.css({overflow:"auto",padding:"0"})):t<=768?(a.css({width:"95vw","max-width":"95vw",margin:"0.5rem auto"}),e.css({height:"60vh","max-height":"60vh"}),d.css({overflow:"auto",padding:"0"})):t<=900?(a.css({width:"90vw","max-width":"90vw",margin:"1rem auto"}),e.css({height:"70vh","max-height":"70vh"}),d.css({overflow:"auto",padding:"0"})):(a.css({width:"90vw","max-width":"1200px",margin:"2rem auto"}),e.css({height:"80vh","max-height":"80vh"}),d.css({overflow:"hidden",padding:"0"})),i.show(),document.body.panoptoWindow=i,document.body.addEventListener("sessionSelected",o.bind(this),!1)}).catch(r.exception)},o=t=>{l("input[id=submit_video]").removeAttr("disabled");var i=l("iframe[id=contentframe]"),a=l("div[id=contentcontainer]"),e=l("img[id=panoptothumbnail]"),d=l("a[id=panoptothumbnaillink]"),o=l("a[id=panoptosessiontitle]"),s=new URL(t.detail.ltiViewerUrl),n=s.searchParams;n.set("course",m),n.set("custom",decodeURI(t.detail.customData)),n.set("contentUrl",t.detail.contentUrl),s.search=n.toString(),l("input[id=sessiontitle]").attr("value",t.detail.title),l("input[id=source]").attr("value",t.detail.contentUrl),l("input[id=customdata]").attr("value",t.detail.customData),l("input[id=width]").attr("value",t.detail.width),l("input[id=height]").attr("value",t.detail.height),l("input[id=thumbnailsource]").attr("value",t.detail.thumbnailUrl),l("input[id=thumbnailwidth]").attr("value",t.detail.thumbnailWidth),l("input[id=thumbnailheight]").attr("value",t.detail.thumbnailHeight),o.text(t.detail.title),o.attr("href",s.toString()),d.attr("href",s.toString()),e.attr("src",t.detail.thumbnailUrl),e.attr("width",t.detail.thumbnailWidth),e.attr("height",t.detail.thumbnailHeight),i.attr("width",t.detail.width),i.attr("height",t.detail.height),i.hasClass("session-hidden")||i.attr("src",s.toString()),a.removeClass("no-session"),h.get_string("replacevideo","panoptosubmission").done(t=>{l("#id_add_video").val(t)}).fail(r.exception),l("#id_add_video").addClass("btn-secondary"),l("#submit_video").addClass("btn-primary"),l("#id_add_video").removeClass("btn-primary"),l("#submit_video").removeClass("btn-secondary"),document.body.panoptoWindow.destroy()};return{initsubmissionpanel:t=>{"0"!==t.addvidbtnid&&"0"!==t.ltilaunchurl&&0!==t.courseid&&0!==t.height&&0!==t.width&&(m=t.courseid,l("#"+t.addvidbtnid).on("click",()=>{i(t.ltilaunchurl,t.height,t.width)}))}}});