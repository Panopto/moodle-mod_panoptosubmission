define(["jquery","core/notification","core/modal_factory","core/str"],(l,r,i,m)=>{let u=null;var e=(t,e,a)=>{Promise.all([m.get_string("select_submission","panoptosubmission"),i.create({type:i.types.DEFAULT,body:`<iframe class="mod-panoptosubmission-iframe-custom" src="${t}" frameborder="0"></iframe>`})]).then(([t,i])=>{i.setTitle(t),i.getRoot().addClass("mod-panoptosubmission-modal-custom-size"),i.getRoot().find(".modal-dialog").addClass("mod-panoptosubmission-modal-dialog-custom").css({width:a+"px","max-width":a+"px"}),i.getRoot().find(".modal-content").addClass("mod-panoptosubmission-modal-content-custom").css({height:e+"px","max-height":e+"px"}),i.getRoot().find(".modal-body").addClass("mod-panoptosubmission-modal-body-custom"),i.show(),document.body.panoptoWindow=i,document.body.addEventListener("sessionSelected",d.bind(this),!1)}).catch(r.exception)},d=t=>{l("input[id=submit_video]").removeAttr("disabled");var i=l("iframe[id=contentframe]"),e=l("div[id=contentcontainer]"),a=l("img[id=panoptothumbnail]"),d=l("a[id=panoptothumbnaillink]"),o=l("a[id=panoptosessiontitle]"),s=new URL(t.detail.ltiViewerUrl),n=s.searchParams;n.set("course",u),n.set("custom",decodeURI(t.detail.customData)),n.set("contentUrl",t.detail.contentUrl),s.search=n.toString(),l("input[id=sessiontitle]").attr("value",t.detail.title),l("input[id=source]").attr("value",t.detail.contentUrl),l("input[id=customdata]").attr("value",t.detail.customData),l("input[id=width]").attr("value",t.detail.width),l("input[id=height]").attr("value",t.detail.height),l("input[id=thumbnailsource]").attr("value",t.detail.thumbnailUrl),l("input[id=thumbnailwidth]").attr("value",t.detail.thumbnailWidth),l("input[id=thumbnailheight]").attr("value",t.detail.thumbnailHeight),o.text(t.detail.title),o.attr("href",s.toString()),d.attr("href",s.toString()),a.attr("src",t.detail.thumbnailUrl),a.attr("width",t.detail.thumbnailWidth),a.attr("height",t.detail.thumbnailHeight),i.attr("width",t.detail.width),i.attr("height",t.detail.height),i.hasClass("session-hidden")||i.attr("src",s.toString()),e.removeClass("no-session"),m.get_string("replacevideo","panoptosubmission").done(t=>{l("#id_add_video").val(t)}).fail(r.exception),l("#id_add_video").addClass("btn-secondary"),l("#submit_video").addClass("btn-primary"),l("#id_add_video").removeClass("btn-primary"),l("#submit_video").removeClass("btn-secondary"),document.body.panoptoWindow.destroy()};return{initsubmissionpanel:t=>{"0"!==t.addvidbtnid&&"0"!==t.ltilaunchurl&&0!==t.courseid&&0!==t.height&&0!==t.width&&(u=t.courseid,l("#"+t.addvidbtnid).on("click",()=>{e(t.ltilaunchurl,t.height,t.width)}))}}});